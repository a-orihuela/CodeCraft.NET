// <auto-generated>
//     This code was generated by CodeCraft.NET Generator.
//     Manual changes to this file may be overwritten.
// </auto-generated>

using System.Collections.ObjectModel;
using System.ComponentModel;
using CommunityToolkit.Mvvm.ComponentModel;
using Microsoft.Extensions.Logging;
using CodeCraft.NET.Application.DTOs.LogEntries;
using CodeCraft.NET.Application.CQRS.Features.LogEntries.Commands.Create;
using CodeCraft.NET.Application.CQRS.Features.LogEntries.Commands.Update;
using CodeCraft.NET.Services.Services;
using CodeCraft.NET.MAUI.Services.Generated;

namespace CodeCraft.NET.MAUI.Helpers.Services.Generated
{
    /// <summary>
    /// Service helper for LogEntry operations optimized for MAUI UI
    /// Provides loading states, error handling, and UI-friendly methods
    /// </summary>
    public partial class LogEntryServiceHelper
    {
        private readonly LogEntryService _service;
        private readonly ILogger<LogEntryServiceHelper> _logger;

        public LogEntryServiceHelper(LogEntryService service, ILogger<LogEntryServiceHelper> logger)
        {
            _service = service;
            _logger = logger;
        }

        /// <summary>
        /// Load all LogEntries with UI loading states
        /// </summary>
        public async Task<MauiServiceResult<ObservableCollection<LogEntryDto>>> LoadAllForUIAsync(
            INotifyPropertyChanged viewModel = null)
        {
            try
            {
                _logger.LogInformation("Loading all LogEntries for UI");
                
                // Set loading state if ViewModel supports it
                SetLoadingState(viewModel, true);
                
                var result = await _service.GetAllAsync();
                
                if (result.IsSuccess)
                {
                    var collection = new ObservableCollection<LogEntryDto>(result.Data);
                    _logger.LogInformation("Successfully loaded {Count} LogEntries", collection.Count);
                    return MauiServiceResult<ObservableCollection<LogEntryDto>>.Success(collection);
                }
                else
                {
                    _logger.LogWarning("Failed to load LogEntries: {Error}", result.ErrorMessage);
                    return MauiServiceResult<ObservableCollection<LogEntryDto>>.Failure(
                        result.ErrorMessage, 
                        "Failed to load LogEntries. Please check your connection and try again.");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while loading LogEntries for UI");
                return MauiServiceResult<ObservableCollection<LogEntryDto>>.Failure(
                    ex.Message,
                    "An unexpected error occurred while loading LogEntries.");
            }
            finally
            {
                SetLoadingState(viewModel, false);
            }
        }

        /// <summary>
        /// Create LogEntry with UI validation and feedback
        /// </summary>
        public async Task<MauiServiceResult<int>> CreateWithUIFeedbackAsync(
            LogEntryCreate command,
            INotifyPropertyChanged viewModel = null)
        {
            try
            {
                _logger.LogInformation("Creating LogEntry via UI");
                
                SetSavingState(viewModel, true);
                
                var result = await _service.CreateAsync(command);
                
                if (result.IsSuccess)
                {
                    _logger.LogInformation("Successfully created LogEntry with ID: {Id}", result.Data);
                    return MauiServiceResult<int>.Success(
                        result.Data,
                        "LogEntry created successfully!");
                }
                else
                {
                    _logger.LogWarning("Failed to create LogEntry: {Error}", result.ErrorMessage);
                    return MauiServiceResult<int>.Failure(
                        result.ErrorMessage,
                        "Failed to create LogEntry. Please check your input and try again.");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while creating LogEntry via UI");
                return MauiServiceResult<int>.Failure(
                    ex.Message,
                    "An unexpected error occurred while creating the LogEntry.");
            }
            finally
            {
                SetSavingState(viewModel, false);
            }
        }

        /// <summary>
        /// Update LogEntry with optimistic UI updates
        /// </summary>
        public async Task<MauiServiceResult<bool>> UpdateWithUIFeedbackAsync(
            LogEntryUpdate command,
            INotifyPropertyChanged viewModel = null)
        {
            try
            {
                _logger.LogInformation("Updating LogEntry {Id} via UI", command.Id);
                
                SetSavingState(viewModel, true);
                
                var result = await _service.UpdateAsync(command);
                
                if (result.IsSuccess)
                {
                    _logger.LogInformation("Successfully updated LogEntry {Id}", command.Id);
                    return MauiServiceResult<bool>.Success(
                        true,
                        "LogEntry updated successfully!");
                }
                else
                {
                    _logger.LogWarning("Failed to update LogEntry {Id}: {Error}", command.Id, result.ErrorMessage);
                    return MauiServiceResult<bool>.Failure(
                        result.ErrorMessage,
                        "Failed to update LogEntry. Please check your input and try again.");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while updating LogEntry {Id} via UI", command.Id);
                return MauiServiceResult<bool>.Failure(
                    ex.Message,
                    "An unexpected error occurred while updating the LogEntry.");
            }
            finally
            {
                SetSavingState(viewModel, false);
            }
        }

        /// <summary>
        /// Delete LogEntry with confirmation handling
        /// </summary>
        public async Task<MauiServiceResult<bool>> DeleteWithConfirmationAsync(
            int id,
            INotifyPropertyChanged viewModel = null)
        {
            try
            {
                _logger.LogInformation("Deleting LogEntry {Id} via UI", id);
                
                SetLoadingState(viewModel, true);
                
                var result = await _service.DeleteAsync(id);
                
                if (result.IsSuccess)
                {
                    _logger.LogInformation("Successfully deleted LogEntry {Id}", id);
                    return MauiServiceResult<bool>.Success(
                        true,
                        "LogEntry deleted successfully!");
                }
                else
                {
                    _logger.LogWarning("Failed to delete LogEntry {Id}: {Error}", id, result.ErrorMessage);
                    return MauiServiceResult<bool>.Failure(
                        result.ErrorMessage,
                        "Failed to delete LogEntry. It may have been already removed.");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while deleting LogEntry {Id} via UI", id);
                return MauiServiceResult<bool>.Failure(
                    ex.Message,
                    "An unexpected error occurred while deleting the LogEntry.");
            }
            finally
            {
                SetLoadingState(viewModel, false);
            }
        }

        /// <summary>
        /// Get LogEntry by ID with UI error handling
        /// </summary>
        public async Task<MauiServiceResult<LogEntryDto>> GetByIdForUIAsync(
            int id,
            INotifyPropertyChanged viewModel = null)
        {
            try
            {
                _logger.LogInformation("Loading LogEntry {Id} for UI", id);
                
                SetLoadingState(viewModel, true);
                
                var result = await _service.GetByIdAsync(id);
                
                if (result.IsSuccess && result.Data != null)
                {
                    _logger.LogInformation("Successfully loaded LogEntry {Id}", id);
                    return MauiServiceResult<LogEntryDto>.Success(result.Data);
                }
                else
                {
                    _logger.LogWarning("LogEntry {Id} not found", id);
                    return MauiServiceResult<LogEntryDto>.Failure(
                        "Entity not found",
                        "The requested LogEntry could not be found.");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while loading LogEntry {Id} for UI", id);
                return MauiServiceResult<LogEntryDto>.Failure(
                    ex.Message,
                    "An unexpected error occurred while loading the LogEntry.");
            }
            finally
            {
                SetLoadingState(viewModel, false);
            }
        }

        #region Private Helper Methods

        private void SetLoadingState(INotifyPropertyChanged viewModel, bool isLoading)
        {
            if (viewModel is ObservableObject observable)
            {
                // Try to set IsLoading property if it exists
                var isLoadingProperty = observable.GetType().GetProperty("IsLoading");
                isLoadingProperty?.SetValue(observable, isLoading);
            }
        }

        private void SetSavingState(INotifyPropertyChanged viewModel, bool isSaving)
        {
            if (viewModel is ObservableObject observable)
            {
                // Try to set IsSaving property if it exists
                var isSavingProperty = observable.GetType().GetProperty("IsSaving");
                isSavingProperty?.SetValue(observable, isSaving);
            }
        }

        #endregion
    }
}