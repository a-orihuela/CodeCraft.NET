// <auto-generated>
//     This code was generated by CodeCraft.NET.
//     Manual changes to this file may be overwritten.
// </auto-generated>

{{~ usings = [
    "Microsoft.VisualStudio.TestTools.UnitTesting",
    "FluentAssertions",
    "Microsoft.EntityFrameworkCore",
    InfrastructureProjectName + ".Persistence",
    InfrastructureProjectName + ".Persistence.Repositories",
    ApplicationProjectName + ".Contracts.Persistence.Repositories",
    DomainProjectName + ".Model"
] ~}}
{{~ include "CodeCraft.NET.Generator.Templates.Partials._render_usings.scriban" ~}}

namespace {{ TestInfrastructureProjectName }}.Repositories
{
    [TestClass]
    public class {{ Name }}RepositoryTests
    {
        private ApplicationDbContext _context;
        private I{{ Name }}Repository _repository;

        [TestInitialize]
        public void Setup()
        {
            var options = new DbContextOptionsBuilder<ApplicationDbContext>()
                .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())
                .Options;

            _context = new ApplicationDbContext(options);
            _repository = new {{ Name }}Repository(_context);
        }

        [TestCleanup]
        public void Cleanup()
        {
            _context.Dispose();
        }

        #region GetByIdAsync Tests

        [TestMethod]
        public async Task GetByIdAsync_ExistingEntity_ReturnsEntity()
        {
            // Arrange
            var entity = new {{ Name }}
            {
                // TODO: Add test data properties
            };

            _context.{{ NamePlural }}.Add(entity);
            await _context.SaveChangesAsync();

            // Act
            var result = await _repository.GetByIdAsync(entity.Id);

            // Assert
            result.Should().NotBeNull();
            result!.Id.Should().Be(entity.Id);
        }

        [TestMethod]
        public async Task GetByIdAsync_NonExistentEntity_ReturnsNull()
        {
            // Arrange
            var nonExistentId = 999;

            // Act
            var result = await _repository.GetByIdAsync(nonExistentId);

            // Assert
            result.Should().BeNull();
        }

        #endregion

        #region GetAllAsync Tests

        [TestMethod]
        public async Task GetAllAsync_EmptyDatabase_ReturnsEmptyList()
        {
            // Act
            var result = await _repository.GetAllAsync();

            // Assert
            result.Should().NotBeNull();
            result.Should().BeEmpty();
        }

        [TestMethod]
        public async Task GetAllAsync_WithEntities_ReturnsAllEntities()
        {
            // Arrange
            var entities = new List<{{ Name }}>
            {
                new {{ Name }} { /* TODO: Add test data */ },
                new {{ Name }} { /* TODO: Add test data */ }
            };

            _context.{{ NamePlural }}.AddRange(entities);
            await _context.SaveChangesAsync();

            // Act
            var result = await _repository.GetAllAsync();

            // Assert
            result.Should().NotBeNull();
            result.Should().HaveCount(2);
        }

        #endregion

        #region AddAsync Tests

        [TestMethod]
        public async Task AddAsync_ValidEntity_AddsEntityToDatabase()
        {
            // Arrange
            var entity = new {{ Name }}
            {
                // TODO: Add test data properties
            };

            // Act
            var result = await _repository.AddAsync(entity);
            await _context.SaveChangesAsync();

            // Assert
            result.Should().NotBeNull();
            result.Id.Should().BeGreaterThan(0);

            var savedEntity = await _context.{{ NamePlural }}.FindAsync(result.Id);
            savedEntity.Should().NotBeNull();
        }

        #endregion

        #region UpdateAsync Tests

        [TestMethod]
        public async Task UpdateAsync_ExistingEntity_UpdatesEntity()
        {
            // Arrange
            var entity = new {{ Name }}
            {
                // TODO: Add test data properties
            };

            _context.{{ NamePlural }}.Add(entity);
            await _context.SaveChangesAsync();

            // Modify entity
            // TODO: Update test data properties

            // Act
            await _repository.UpdateAsync(entity);
            await _context.SaveChangesAsync();

            // Assert
            var updatedEntity = await _context.{{ NamePlural }}.FindAsync(entity.Id);
            updatedEntity.Should().NotBeNull();
            // TODO: Assert updated properties
        }

        #endregion

        #region DeleteAsync Tests

        [TestMethod]
        public async Task DeleteAsync_ExistingEntity_RemovesEntity()
        {
            // Arrange
            var entity = new {{ Name }}
            {
                // TODO: Add test data properties
            };

            _context.{{ NamePlural }}.Add(entity);
            await _context.SaveChangesAsync();

            // Act
            await _repository.DeleteAsync(entity);
            await _context.SaveChangesAsync();

            // Assert
            var deletedEntity = await _context.{{ NamePlural }}.FindAsync(entity.Id);
            deletedEntity.Should().BeNull();
        }

        #endregion
    }
}